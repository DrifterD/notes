# mysql-learning
记录mysql日志

## 事物
事物标准特性：ACID
1. 原子性（atomicity）
2. 一致性（consistency）
3. 隔离性(isolation)
4. 持久性（durability）

### 隔离级别
隔离性又分为四种类型

* READ UNCOMMITTED(未提交读)
事物中修改的且没有提交的数据其他事物也可以读取，即脏读

* READ COMMITTED(提交读)
一个事物从喀什直到提交之前，所有做的任何修改对其他事物不可见，这个级别有时候会叫做**不可重复读取（nonrepeatable read）**，因为两次执行同样的查询，可能会得到不一样结果

* REPEATABLE READ(可重复读) 默认
理论上，可重复读无法解决幻读问题，但是在mysql中InnoDB和XtraDB通过多版本控制（MVCC multiversion concurrency control）解决幻读问题

* SERIALIAZBLE 最高级别隔离，读取 的每一行数据上都枷锁，避免幻读问题。但是可能导致超时和锁竞争
>注： 幻读：基于插入或者删除场景
不可重复读取：基于update场景

## 索引
索引不同类型有不同特性，主要有以下类型：

### b-tree
大部分索引结构，实际上多数引擎通过B+Tree实现，即每一个叶子节点都包含指向下一个叶子节点的指针，从而方便叶子节点范围遍历。B-Tree 所有的值都是按照顺序存储
优点：
* 支持精确查询
* 最左查询
* 范围查询
* 只访问索引的查询，即"覆盖索引"
......

### 哈希索引
hash索引必须精确匹配才能有效
只有memory引擎支持哈希索引

优点：
数据存储紧凑，快

缺点：
* 只保存哈希值和行索引，不保存字段值
* 不能按照索引值顺序存储，不能用于排序
* 只支持等值比较查询
* 哈希冲突叫多的场景下维护代价较高
* 索引全部列内容哈希的值，所以无法部分索引匹配查询
* 只支持等值比较查询，包括=，in(),<=>


innoDB 是否也支持hash索引呢？？

### R-tree 空间索引
MyIsam 支持空间索引
Mysql GIS支持不完善

### 全文索引

### 高性能索引策略
1.独立列索引
>独立列值在where条件时不是函数参数，也不是表达式一部分

2. 前缀索引和索引的选择性
## 分区表
分区表是一个逻辑表，底层由多个物理表实现

### 限制
1. 在MyISAM引擎下操作会导致表级锁，甚至整个分区，但是innoDB不存在
2. innoDB 外键和分区存在不兼容,innoDB不支持多磁盘用于子分区
3. InnoDB 使用alter table .... optimize partition 是不能正常工作在分区表中
4. 所有分区表引擎必须一致且和主表引擎一致
5. 删除分区，该分区内所有数据全部被删除
6. 所有被用在分区上字段必须是该表所有唯一索引的一部分(主键也是唯一索引一种，如果存在多个唯一索引，取公共字段)
>All columns used in the partitioning expression for a partitioned table must be part of every unique key that the table may have.

7. 一个表中没有主键或者没有唯一索引，那么分区字段不做限制
8. 在没有主键和唯一索引下创建的分区，在后期添加主键或者唯一索引时是受限制
9. 复杂的分区表达式可能会带来性能风险，因为更新，插入和删除一行都会计算一次分区表达式
10. 一个表最多只能分1024个子表
